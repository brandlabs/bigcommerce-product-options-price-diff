!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ProductOptionsPriceDiff=e():t.ProductOptionsPriceDiff=e()}(global,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function o(t){return function(){var e=t.apply(this,arguments);return new Promise((function(t,n){return function r(o,i){try{var u=e[o](i),a=u.value}catch(t){return void n(t)}if(!u.done)return Promise.resolve(a).then((function(t){r("next",t)}),(function(t){r("throw",t)}));t(a)}("next")}))}}e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new u(Object.assign({},i,t))};var i={productOptions:[],productId:null,startingPrice:null,autoload:!0,template:"products/bulk-discount-rates",pricePath:"price.without_tax.value",productIdSelector:"input[name=product_id]",onGetPriceDiff:null,optionLabelSelector:'label[data-product-attribute-value="%f"]',scope:null},u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.priceDiffs={},this.options=e,null===this.options.productId&&(this.options.productId=document.querySelector(this.options.productIdSelector).value),this.options.autoload&&this.loadPrices()}return r(t,[{key:"getStartingPrice",value:function(){var t=o(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.getPrice());case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getPrice",value:function(){var t=o(regeneratorRuntime.mark((function t(e){var n,r,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getProductAttributesData(e);case 2:return n=t.sent,r=void 0,this.options.pricePath.split(".").forEach((function(t){n=n[t],r=n})),this.onGetPrice(e,r,(function(t,e){o.updateConfig(t,e,(function(){o.updateOptionLabel(t,e)}))})),t.abrupt("return",r);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getProductAttributesData",value:function(t){var e=this,n=this.options.productId,r=this.options.template,o=Object.assign({action:"add",product_id:n},t);return new Promise((function(t,i){stencilUtils.api.productAttributes.optionChange(n,e._queryParam(o),r,(function(e,n){e?i(e):t(n.data||{})}))}))}},{key:"loadPrices",value:function(){var t=o(regeneratorRuntime.mark((function t(){var e,n=this,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&this.options.productOptions.forEach((function(t){t.values.forEach((function(t){var e=n.cacheStorage().get(t.id);null!==e&&n.updateConfig(t.id,e,(function(){n.updateOptionLabel(t.id,e)}))}))})),null!==this.options.startingPrice){t.next=5;break}return t.next=4,this.getStartingPrice();case 4:this.options.startingPrice=t.sent;case 5:if(this.options.startingPrice||0===this.options.startingPrice){t.next=7;break}throw new Error("Failed to obtain starting price.");case 7:return e=[],this.options.productOptions.forEach((function(t){t.values.forEach((function(r){var o={};o["attribute["+t.id+"]"]=r.id,e.push(n.getPrice(o))}))})),t.next=11,Promise.all(e);case 11:return t.abrupt("return",this.priceDiffs);case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"onGetPrice",value:function(t,e,n){var r=t?Object.keys(t):0;if(1===r.length){var o=t[r[0]],i=e-this.options.startingPrice;this.cacheStorage().set(o,i),n&&"function"==typeof n&&n(o,i)}}},{key:"updateConfig",value:function(t,e,n){this.priceDiffs[t]=e,"function"==typeof this.options.onGetPriceDiff?this.options.onGetPriceDiff(t,e):"function"==typeof n&&n()}},{key:"updateOptionLabel",value:function(t,e){document.querySelectorAll(this.options.optionLabelSelector.replace("%f",t)).forEach((function(t){var n=t.querySelector("span");n&&n.parentNode.removeChild(n),(n=document.createElement("span")).classList.add("js-price-diff"),e>0?(n.innerText="[Add $"+e.toFixed(2)+"]",t.appendChild(n)):e<0&&(n.innerText="[Subtract $"+Math.abs(e).toFixed(2)+"]",t.appendChild(n))}))}},{key:"cacheStorage",value:function(t){return t&&t.key||(t={key:"price-diff-"+this.options.productId+"-"}),{get:function(e){return JSON.parse(window.sessionStorage.getItem(""+t+e)||"null")},set:function(e,n){window.sessionStorage.setItem(""+t+e,JSON.stringify(n))}}}},{key:"_queryParam",value:function(t){var e=[];return Object.keys(t).forEach((function(n){return e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]))})),e.join("&")}}]),t}()}])}));